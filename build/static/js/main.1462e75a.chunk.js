(this.webpackJsonpld46=this.webpackJsonpld46||[]).push([[0],[function(t,i,e){var s;!function(){"use strict";var h=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6,n=1/6,r=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;function o(t){var i;i="function"==typeof t?t:t?function(){var t=0,i=0,e=0,s=1,h=f();t=h(" "),i=h(" "),e=h(" ");for(var a=0;a<arguments.length;a++)(t-=h(arguments[a]))<0&&(t+=1),(i-=h(arguments[a]))<0&&(i+=1),(e-=h(arguments[a]))<0&&(e+=1);return h=null,function(){var h=2091639*t+2.3283064365386963e-10*s;return t=i,i=e,e=h-(s=0|h)}}(t):Math.random,this.p=u(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}function u(t){var i,e=new Uint8Array(256);for(i=0;i<256;i++)e[i]=i;for(i=0;i<255;i++){var s=i+~~(t()*(256-i)),h=e[i];e[i]=e[s],e[s]=h}return e}function f(){var t=4022871197;return function(i){i=i.toString();for(var e=0;e<i.length;e++){var s=.02519603282416938*(t+=i.charCodeAt(e));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)}}o.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,i){var e,s,n=this.permMod12,r=this.perm,l=this.grad3,o=0,u=0,f=0,d=(t+i)*h,y=Math.floor(t+d),c=Math.floor(i+d),v=(y+c)*a,g=t-(y-v),p=i-(c-v);g>p?(e=1,s=0):(e=0,s=1);var x=g-e+a,M=p-s+a,m=g-1+2*a,w=p-1+2*a,k=255&y,S=255&c,b=.5-g*g-p*p;if(b>=0){var T=3*n[k+r[S]];o=(b*=b)*b*(l[T]*g+l[T+1]*p)}var C=.5-x*x-M*M;if(C>=0){var z=3*n[k+e+r[S+s]];u=(C*=C)*C*(l[z]*x+l[z+1]*M)}var D=.5-m*m-w*w;if(D>=0){var E=3*n[k+1+r[S+1]];f=(D*=D)*D*(l[E]*m+l[E+1]*w)}return 70*(o+u+f)},noise3D:function(t,i,e){var s,h,a,r,l,o,u,f,d,y,c=this.permMod12,v=this.perm,g=this.grad3,p=(t+i+e)*(1/3),x=Math.floor(t+p),M=Math.floor(i+p),m=Math.floor(e+p),w=(x+M+m)*n,k=t-(x-w),S=i-(M-w),b=e-(m-w);k>=S?S>=b?(l=1,o=0,u=0,f=1,d=1,y=0):k>=b?(l=1,o=0,u=0,f=1,d=0,y=1):(l=0,o=0,u=1,f=1,d=0,y=1):S<b?(l=0,o=0,u=1,f=0,d=1,y=1):k<b?(l=0,o=1,u=0,f=0,d=1,y=1):(l=0,o=1,u=0,f=1,d=1,y=0);var T=k-l+n,C=S-o+n,z=b-u+n,D=k-f+2*n,E=S-d+2*n,F=b-y+2*n,R=k-1+.5,P=S-1+.5,A=b-1+.5,L=255&x,I=255&M,V=255&m,B=.6-k*k-S*S-b*b;if(B<0)s=0;else{var W=3*c[L+v[I+v[V]]];s=(B*=B)*B*(g[W]*k+g[W+1]*S+g[W+2]*b)}var q=.6-T*T-C*C-z*z;if(q<0)h=0;else{var H=3*c[L+l+v[I+o+v[V+u]]];h=(q*=q)*q*(g[H]*T+g[H+1]*C+g[H+2]*z)}var G=.6-D*D-E*E-F*F;if(G<0)a=0;else{var N=3*c[L+f+v[I+d+v[V+y]]];a=(G*=G)*G*(g[N]*D+g[N+1]*E+g[N+2]*F)}var O=.6-R*R-P*P-A*A;if(O<0)r=0;else{var _=3*c[L+1+v[I+1+v[V+1]]];r=(O*=O)*O*(g[_]*R+g[_+1]*P+g[_+2]*A)}return 32*(s+h+a+r)},noise4D:function(t,i,e,s){var h,a,n,o,u,f,d,y,c,v,g,p,x,M,m,w,k,S=this.perm,b=this.grad4,T=(t+i+e+s)*r,C=Math.floor(t+T),z=Math.floor(i+T),D=Math.floor(e+T),E=Math.floor(s+T),F=(C+z+D+E)*l,R=t-(C-F),P=i-(z-F),A=e-(D-F),L=s-(E-F),I=0,V=0,B=0,W=0;R>P?I++:V++,R>A?I++:B++,R>L?I++:W++,P>A?V++:B++,P>L?V++:W++,A>L?B++:W++;var q=R-(f=I>=3?1:0)+l,H=P-(d=V>=3?1:0)+l,G=A-(y=B>=3?1:0)+l,N=L-(c=W>=3?1:0)+l,O=R-(v=I>=2?1:0)+2*l,_=P-(g=V>=2?1:0)+2*l,j=A-(p=B>=2?1:0)+2*l,U=L-(x=W>=2?1:0)+2*l,K=R-(M=I>=1?1:0)+3*l,X=P-(m=V>=1?1:0)+3*l,Y=A-(w=B>=1?1:0)+3*l,J=L-(k=W>=1?1:0)+3*l,Z=R-1+4*l,$=P-1+4*l,Q=A-1+4*l,tt=L-1+4*l,it=255&C,et=255&z,st=255&D,ht=255&E,at=.6-R*R-P*P-A*A-L*L;if(at<0)h=0;else{var nt=S[it+S[et+S[st+S[ht]]]]%32*4;h=(at*=at)*at*(b[nt]*R+b[nt+1]*P+b[nt+2]*A+b[nt+3]*L)}var rt=.6-q*q-H*H-G*G-N*N;if(rt<0)a=0;else{var lt=S[it+f+S[et+d+S[st+y+S[ht+c]]]]%32*4;a=(rt*=rt)*rt*(b[lt]*q+b[lt+1]*H+b[lt+2]*G+b[lt+3]*N)}var ot=.6-O*O-_*_-j*j-U*U;if(ot<0)n=0;else{var ut=S[it+v+S[et+g+S[st+p+S[ht+x]]]]%32*4;n=(ot*=ot)*ot*(b[ut]*O+b[ut+1]*_+b[ut+2]*j+b[ut+3]*U)}var ft=.6-K*K-X*X-Y*Y-J*J;if(ft<0)o=0;else{var dt=S[it+M+S[et+m+S[st+w+S[ht+k]]]]%32*4;o=(ft*=ft)*ft*(b[dt]*K+b[dt+1]*X+b[dt+2]*Y+b[dt+3]*J)}var yt=.6-Z*Z-$*$-Q*Q-tt*tt;if(yt<0)u=0;else{var ct=S[it+1+S[et+1+S[st+1+S[ht+1]]]]%32*4;u=(yt*=yt)*yt*(b[ct]*Z+b[ct+1]*$+b[ct+2]*Q+b[ct+3]*tt)}return 27*(h+a+n+o+u)}},o._buildPermutationTable=u,void 0===(s=function(){return o}.call(i,e,i,t))||(t.exports=s),i.SimplexNoise=o,t.exports=o}()},function(t,i,e){t.exports=e(2)},function(t,i,e){"use strict";e.r(i);var s={x:0,y:0,ox:0,oy:0,vx:0,vy:0,leftDown:!1,rightDown:!1,width:0,height:0,leftHit:function(){if(this.leftDown)return this.leftDown=!1,!0},init:function(t){var i=this;this.width=t.width,this.height=t.height,t.onmousemove=function(t){i.ox=i.x,i.oy=i.y,i.x=t.offsetX,i.y=t.offsetY,i.vx=i.x-i.ox,i.vy=i.y-i.oy},t.onmousedown=function(t){0===t.button&&(i.leftDown=!0),2===t.button&&(i.rightDown=!0)},t.onmouseup=function(t){0===t.button&&(i.leftDown=!1),2===t.button&&(i.rightDown=!1)},t.onmouseout=function(){i.leftDown=!1,i.rightDown=!1}}};function h(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function a(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}var r=function(){function t(i,e){h(this,t),this.height=e,this.width=i,this.hitAnimation=!1,this.hitAnimationLength=100,this.currentHitAnimationLength=100}return n(t,[{key:"render",value:function(t,i,e){if(t.resetTransform(),t.fillStyle="rgba(0, 127, 0, 1.0)",t.fillRect(10,10,100,10),i.health>0)t.fillStyle="rgba(86, 255, 86, 0.8)",t.fillRect(10,10,i.health,10);else{t.fillStyle="rgba(0, 0, 0, .8)",t.fillRect(0,0,this.width,this.height),t.font="40px cousine";var s="DEAD",h=t.measureText(s);t.fillStyle="rgba(255, 0, 0, .8)",t.fillText(s,this.width/2-h.width/2,this.height/2),s="PRESS R TO RESTART",h=t.measureText(s),t.fillText(s,this.width/2-h.width/2,this.height/2+2*parseInt(t.font))}if(t.fillStyle="rgba(72, 0, 98, 0.8)",t.fillRect(10,30,100,10),e.grid.totalPurple>0){t.fillStyle="rgba(128, 0, 128, 1.0)";var a=e.grid.totalPurple/e.entityManager.levelConfig.goal*100;t.fillRect(10,30,a,10)}if(i.hit||this.hitAnimation){this.hitAnimation=!0;var n=this.currentHitAnimationLength/this.hitAnimationLength*.5;t.fillStyle="rgba(255, 0, 0, "+n+")",t.fillRect(0,0,this.width,this.height),this.currentHitAnimationLength--,this.currentHitAnimationLength<0&&(this.currentHitAnimationLength=50,this.hitAnimation=!1)}}}]),t}(),l={_pressed:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,W:87,S:83,A:65,D:68,Z:90,B:66,R:82,M:77,F2:113,isDown:function(t){return this._pressed[t]},isHit:function(t){var i=!!this._pressed[t];return delete this._pressed[t],i},onKeydown:function(t){t.repeat||(this._pressed[t.keyCode]=!0)},onKeyup:function(t){delete this._pressed[t.keyCode]}};function o(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,s=new Array(i);e<i;e++)s[e]=t[e];return s}function u(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,i){if(t){if("string"===typeof t)return o(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,i):void 0}}(t))){var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,h,a=!0,n=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return a=t.done,t},e:function(t){n=!0,h=t},f:function(){try{a||null==s.return||s.return()}finally{if(n)throw h}}}}window.addEventListener("keyup",(function(t){l.onKeyup(t)}),!1),window.addEventListener("keydown",(function(t){l.onKeydown(t)}),!1);var f=function(){function t(i,e){h(this,t),this.x=i,this.y=e,this.life=20+Math.floor(10*Math.random()),this.type="fire"}return n(t,[{key:"update",value:function(i,e,s){if(this.life--,15==this.life)for(var h=-1;h<=1;h++)for(var a=-1;a<=1;a++)5===e.getBlockValue(h+this.x,a+this.y)&&(e.setBlockValue(h+this.x,a+this.y,6),i.addEntity(new t(h+this.x,a+this.y)));0===this.life&&(this.deleteFlag=!0,e.setBlockValue(this.x,this.y,7))}},{key:"render",value:function(){}}]),t}(),d=function(){function t(){h(this,t),this.particles=[]}return n(t,[{key:"resetParticles",value:function(){this.particles.length=0}},{key:"deleteParticles",value:function(t){if(t.levelConfig.noFail&&this.particles.length>0){var i=Math.floor(Math.random()*this.particles.length);0===this.particles[i].type&&this.particles.splice(i,1)}for(var e=0;e<this.particles.length;e++)this.particles[e].deleteFlag&&(this.particles.splice(e,1),e--)}},{key:"update",value:function(t,i,e){for(var s=0;this.particles.length<e.levelConfig.waterSupply&&s<10;){s++;var h=2*Math.random()*Math.PI;this.particles.push(new c(t.width*t.tileSize/2+Math.sin(h)*e.levelConfig.outerRadius*4,t.height*t.tileSize/2+Math.cos(h)*e.levelConfig.outerRadius*4,0))}this.deleteParticles(e);var a=Math.ceil(80),n=Math.ceil(80),r=new Array(a*n).fill(0);r=r.map((function(t){return new Array}));for(var l=0;l<this.particles.length;l++){var o=this.particles[l];if(o.vel.x+=o.force.x,o.vel.y+=o.force.y,o.vel.x*=.999,o.vel.y*=.999,o.pos.x+=o.vel.x*i,o.pos.y+=o.vel.y*i,o.force.x=0,o.force.y=0,o.density=0,o.densityNear=0,o.neighbors=[],2===o.type){o.dryTimer||(o.dryTimer=0),Math.abs(o.vel.x)+Math.abs(o.vel.y)>.3&&(o.dryTimer=0),o.dryTimer++;var u=1-Math.max(0,o.dryTimer-100)/400;if(o.vel.x*=u,o.vel.y*=u,o.dryTimer>500){o.deleteFlag=!0;for(var f=Math.floor(o.pos.x/t.tileSize),d=Math.floor(o.pos.y/t.tileSize),v=-3;v<=3;v++)for(var g=-3;g<=3;g++){v*v+g*g<4&&t.setBlockValue(v+f,g+d,3)}}}var p=o.pos.x-1200,x=o.pos.y-1200,M=Math.sqrt(p*p+x*x);p/=M,x/=M,o.force.x=.01*-p,o.force.y=.01*-x,this.collideGrid(t,o,e);var m=Math.min(a-1,Math.max(0,Math.floor(o.pos.x/30))),w=Math.min(n-1,Math.max(0,Math.floor(o.pos.y/30)));isNaN(m)||isNaN(w)?o.deleteFlag=!0:r[m+w*a].push(o)}for(var k=function(t,i){if(0!==t.length&&0!==i.length)for(var e=0;e<t.length;e++)for(var s=t[e],h=t===i?e+1:0;h<i.length;h++){var a=i[h],n=a.pos.x-s.pos.x,r=a.pos.y-s.pos.y,l=Math.sqrt(n*n+r*r);if(l<20){1===s.type&&0===a.type&&(s.type=2,a.deleteFlag=!0),1===a.type&&0===s.type&&(s.deleteFlag=!0,a.type=2);var o=1-l/20,u=o*o;s.density+=u,s.densityNear+=o*u,a.density+=u,a.densityNear+=o*u,s.neighbors.push(new y(a,n,r,l,o))}}},S=0;S<a;S++)for(var b=0;b<n;b++){var T=r[S+b*a],C=b===n-1;S===a-1?C||k(T,r[S+(b+1)*a]):(k(T,r[S+1+b*a]),C||(k(T,r[S+1+(b+1)*a]),k(T,r[S+(b+1)*a]),k(r[S+1+b*a],r[S+(b+1)*a]))),k(T,T)}for(var z=0;z<this.particles.length;z++){var D=this.particles[z];D.pressure=.05*(D.density-1),D.pressureNear=.1*D.densityNear}for(var E=0;E<this.particles.length;E++)for(var F=this.particles[E],R=0;R<F.neighbors.length;R++){var P=F.neighbors[R],A=P.particle,L=P.q*(F.pressure+A.pressure+(F.pressureNear+A.pressureNear)*P.q),I=(A.vel.x-F.vel.x)*P.q*.003,V=(A.vel.y-F.vel.y)*P.q*.003,B=L*P.dx/P.dist-I,W=L*P.dy/P.dist-V,q=2*F.mass/(A.mass+F.mass),H=2*A.mass/(A.mass+F.mass);F.force.x-=B*H,F.force.y-=W*H,A.force.x+=B*q,A.force.y+=W*q}}},{key:"collideGrid",value:function(t,i,e){var s=t.tileSize,h=10;2===i.type&&(h=7);var a=Math.floor(i.pos.x/s),n=Math.floor(i.pos.y/s);if(t.getBlockValue(a,n)>1)return i.vel.x=0,i.vel.y=0,i.force.x=0,i.force.y=0,void(i.deleteFlag=!0);for(var r=Math.ceil(h/s),l=-r;l<=r;l++)for(var o=-r;o<=r;o++){var u=l+a,d=o+n;if(t.boundsCheck(u,d)){var y=t.tiles[u+d*t.width];if(y>1){if(5===y&&Math.abs(l)+Math.abs(o)<=1&&0===i.type)return i.deleteFlag=!0,void t.setBlockValue(a,n,5);if(5===y&&0===i.type)continue;var c=(d+.5)*s,v=(u+.5)*s-i.pos.x,g=c-i.pos.y,p=Math.sqrt(v*v+g*g);if(p<h){1===i.type&&5===y&&(t.setBlockValue(u,d,6),e.entities.push(new f(u,d)));var x=v/p,M=g/p,m=h-p;i.pos.x-=m*x,i.pos.y-=m*M,i.vel.x-=.1*x,i.vel.y-=.1*M}}}}}},{key:"render",value:function(t){var i,e=u(this.particles);try{for(e.s();!(i=e.n()).done;){var s=i.value,h="rgba(50,100,255,.5)";1===s.type&&(h="rgba(255,125,0,1)"),2===s.type&&(h="rgba(200,200,200,1)"),h!==t.fillStyle&&(t.fillStyle=h),t.fillRect(s.pos.x-5,s.pos.y-5,10,10)}}catch(a){e.e(a)}finally{e.f()}}}]),t}(),y=function t(i,e,s,a,n){h(this,t),this.particle=i,this.dx=e,this.dy=s,this.dist=a,this.q=n},c=function t(i,e,s){h(this,t),this.mass=1===s?3:1,this.type=s,this.pos={x:i,y:e},this.vel={x:0,y:0},this.pressure=0,this.pressureNear=0,this.force={x:0,y:0},this.density=0,this.densityNear=0,this.neighbors=[]},v=function(){function t(i,e,s,a,n){h(this,t),this.pos=i,this.vel=e,this.life=a,this.color=s,this.startFade=n}return n(t,[{key:"update",value:function(t,i,e){this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.life-=e,this.life<0&&(this.deleteFlag=!0)}},{key:"render",value:function(t){var i=this.life>this.startFade?1:this.life/this.startFade;t.fillStyle="rgba("+this.color+","+i+")",t.translate(this.pos.x,this.pos.y),t.fillRect(-2,-2,4,4),t.translate(-this.pos.x,-this.pos.y)}}]),t}(),g=function(){function t(i,e){h(this,t),this.x=i,this.y=e,this.angle=Math.random()*Math.PI*2,this.turn=.03*(Math.random()-.5),this.history=[],this.straightTimer=4,this.type="digger",this.health=100}return n(t,[{key:"explode",value:function(t){this.deleteFlag=!0;for(var i=0;i<this.history.length;i++)t.fluid.particles.push(new c(this.history[i].x+10*Math.random()-5,this.history[i].y+10*Math.random()-5,1))}},{key:"update",value:function(t,i,e){this.history.unshift({x:this.x,y:this.y}),this.history.length>40&&this.history.pop(),this.x+=3*Math.sin(this.angle),this.y+=3*Math.cos(this.angle),this.angle+=this.turn,this.straightTimer-=e,this.straightTimer<0&&(this.turn=0,(this.x<0||this.y<0||this.x>i.width*i.tileSize||this.y>i.height*i.tileSize)&&(this.deleteFlag=!0));for(var s=i.worldToGrid(this.x),h=i.worldToGrid(this.y),a=-5;a<=5;a++)for(var n=-5;n<=5;n++)if(a*a+n*n<10){var r=i.getBlockValue(a+s,n+h);r>1&&i.setBlockValue(a+s,n+h,1),5==r&&this.explode(t)}var l,o=u(t.entities);try{for(o.s();!(l=o.n()).done;){var f=l.value;if("bullet"===f.type)for(var d=this.history.length-1;d>=0;d--)if(d%5===0){var y=f.pos.x-this.history[d].x,c=f.pos.y-this.history[d].y;Math.sqrt(y*y+c*c)<=10&&(f.hit=!0,this.health-=20,this.flash=!0)}}}catch(v){o.e(v)}finally{o.f()}this.health<0&&this.explode(t)}},{key:"render",value:function(t){this.flash?(t.fillStyle="#ff7070",this.flash=!1):t.fillStyle="#707070",t.strokeStyle="#222222";for(var i=this.history.length-1;i>=0;i--)if(i%5===0){var e=this.history[i];t.beginPath(),t.arc(e.x,e.y,10,0,2*Math.PI,!1),t.fill(),t.stroke()}}}]),t}(),p=0,x=function(){function t(i,e){h(this,t),this.type="eater",this.x=i,this.y=e,this.dir=Math.random()>.5?1:-1,this.vx=0,this.vy=0,this.radius=12,this.health=100,this.jumpTime=3*Math.random()+2,this.diffTime=0,this.oldX=0,this.oldY=0,this.eating=!1,this.totalEaten=0,this.cnt=p++}return n(t,[{key:"update",value:function(t,i,e){if(this.angle=Math.atan2(this.y-i.height*i.tileSize/2,this.x-i.width*i.tileSize/2),e=Math.max(e,.025),!this.eating){this.diffTime-=e,this.diffTime<0&&(Math.abs(this.x-this.oldX)+Math.abs(this.y-this.oldY)<10&&(this.dir=-this.dir),this.diffTime=3.3,this.oldX=this.x,this.oldY=this.y),this.vy-=200*e*Math.sin(this.angle),this.vx-=200*e*Math.cos(this.angle),this.jumpTime<0&&(this.jumpTime+=3+.1*Math.random(),this.vy+=300*Math.sin(this.angle),this.vx+=300*Math.cos(this.angle));var s=80*e*Math.sin(this.angle),h=-80*e*Math.cos(this.angle);this.vx+=s*this.dir,this.vy+=h*this.dir,this.jumpTime-=e}this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=.99,this.vy*=.99,this.eating&&(this.vx*=.5,this.vy*=.5),this.collideClosestGrid(i,t);var a,n=u(t.fluid.particles);try{for(n.s();!(a=n.n()).done;){var r=a.value,l=r.pos.x-this.x,o=r.pos.y-this.y;Math.sqrt(l*l+o*o)<this.radius&&(1===r.type&&(this.health-=1),this.vx=.99*this.vx+60*r.vel.x*.01,this.vy=.99*this.vy+60*r.vel.y*.01,r.vel.x=.95*r.vel.x+this.vx/60*.05,r.vel.y=.95*r.vel.y+this.vy/60*.05)}}catch(w){n.e(w)}finally{n.f()}var f,d=u(t.entities);try{for(d.s();!(f=d.n()).done;){var y=f.value;if("bullet"===y.type){var c=y.pos.x-this.x,v=y.pos.y-this.y;Math.sqrt(c*c+v*v)<=this.radius&&(y.hit=!0,this.health-=35,this.flash=!0)}if("eater"===y.type&&y!==this){var g=y.x-this.x,p=y.y-this.y,x=Math.sqrt(g*g+p*p);if(x<=2*this.radius){var M=g/x,m=p/x;this.radius;this.vx-=M,this.vy-=m,y.vx+=M,y.vy+=m}}}}catch(w){d.e(w)}finally{d.f()}this.health<=0&&(this.deleteFlag=!0)}},{key:"collideClosestGrid",value:function(i,e){var s=i.tileSize,h=Math.floor(this.x/s),a=Math.floor(this.y/s),n=Math.ceil(this.radius/s)+4,r=this.eating;this.eating=!1;for(var l=-n;l<=n;l++)for(var o=-n;o<=n;o++){var u=l+h,f=o+a;if(i.boundsCheck(u,f)){var d=i.tiles[u+f*i.width];if(d>1){var y=(f+.5)*s,c=(u+.5)*s-this.x,v=y-this.y,g=Math.sqrt(c*c+v*v);if(g<12){var p=c/g,x=v/g;this.x-=p*(12-g),this.y-=x*(12-g),this.vx-=.2*p,this.vy-=.2*x,this.vy*=.9,this.vx*=.9}5===d&&g<16&&(this.eating=!0,g<12&&(i.setBlockValue(u,f,1),this.totalEaten++),this.vx+=20*c/g,this.vy+=20*v/g),g<12&&r&&i.setBlockValue(u,f,1)}}}this.totalEaten>100&&(e.addEntity(new t(this.x+1,this.y)),this.totalEaten=0),this.eating&&Math.abs(this.vx)+Math.abs(this.vy)<10&&(this.vx+=20)}},{key:"render",value:function(t){this.flash?(t.fillStyle="#ff0000",this.flash=!1):t.fillStyle="#009900",t.lineWidth=2,t.translate(this.x,this.y);var i=this.eating?Math.atan2(this.vy,this.vx):0,e=this.eating?Math.PI/6:0;t.rotate(this.angle+i),t.beginPath(),t.arc(0,0,10,e+Math.PI/2,2*Math.PI-e+Math.PI/2,!1),this.eating&&(t.lineTo(0,0),t.closePath()),t.fill(),this.eating||(t.strokeStyle="#333333",t.stroke(),t.beginPath(),t.moveTo(0,0),-1===this.dir||this.eating?t.lineTo(0,10):t.lineTo(0,-10),t.stroke()),t.rotate(-this.angle-i),t.translate(-this.x,-this.y)}}]),t}(),M=function(){function t(i,e){h(this,t),this.pos=i,this.vel=e,this.type="bullet"}return n(t,[{key:"update",value:function(t,i,e){if(this.pos.x<0||this.pos.y<0||this.pos.x>i.width*i.tileSize||this.pos.y>i.height*i.tileSize)this.deleteFlag=!0;else for(var s=0;s<5;s++)if(this.pos.x+=this.vel.x*e/5,this.pos.y+=this.vel.y*e/5,i.getBlockValue(i.worldToGrid(this.pos.x),i.worldToGrid(this.pos.y))>1||this.hit){this.deleteFlag=!0;for(var h=function(){return 2*Math.random()-1},a=0;a<5;a++)t.addEntity(new v({x:this.pos.x,y:this.pos.y},{x:300*h(),y:300*h()},"255,255,255",.1,.1));Math.random()>.98&&!this.hit&&(Math.random()>.5?t.levelConfig.diggers&&t.addEntity(new g(this.pos.x,this.pos.y)):t.levelConfig.eaters&&t.addEntity(new x(this.pos.x,this.pos.y)));for(var n=Math.floor(this.pos.x/i.tileSize),r=Math.floor(this.pos.y/i.tileSize),l=-7;l<=7;l++)for(var o=-7;o<7;o++)l*l+o*o<36&&i.getBlockValue(l+n,o+r)>1&&i.setBlockValue(l+n,o+r,1)}}},{key:"render",value:function(t){t.fillStyle="#ffff00",t.translate(this.pos.x,this.pos.y),t.fillRect(-2,-2,4,4),t.translate(-this.pos.x,-this.pos.y)}}]),t}(),m=function(){function t(i,e){h(this,t),this.type="player",this.x=i,this.y=e,this.angle=0,this.vx=0,this.vy=0,this.maxVel=5e5,this.radius=12,this.health=100,this.shootCooldown=0,this.hit=!1}return n(t,[{key:"update",value:function(t,i,e){var h=s.x-s.width/2,a=s.y-s.height/2,n=t.cam.angle;this.x<0&&(this.x=0,this.vx=0),this.y<0&&(this.y=0,this.vy=0),this.x>i.width*i.tileSize&&(this.x=i.width*i.tileSize,this.vx=0),this.y>i.height*i.tileSize&&(this.y=i.height*i.tileSize,this.vy=0),this.angle=Math.atan2(a,h)+n,e=Math.max(e,.025),(l.isDown(l.A)||l.isDown(l.LEFT))&&(this.vx-=500*e*Math.cos(n),this.vy-=500*e*Math.sin(n)),(l.isDown(l.D)||l.isDown(l.RIGHT))&&(this.vx+=500*e*Math.cos(n),this.vy+=500*e*Math.sin(n)),(l.isDown(l.W)||l.isDown(l.UP))&&(this.vy-=500*e*Math.cos(n),this.vx+=500*e*Math.sin(n)),(l.isDown(l.S)||l.isDown(l.DOWN))&&(this.vy+=500*e*Math.cos(n),this.vx-=500*e*Math.sin(n)),this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=.9,this.vy*=.9,this.collideClosestGrid(i),this.shootCooldown-=e,s.leftDown&&this.shootCooldown<0&&(this.shootCooldown=.2,t.addEntity(new M({x:this.x,y:this.y},{x:500*Math.cos(this.angle),y:500*Math.sin(this.angle)}))),this.hit=!1;var r,o=u(t.fluid.particles);try{for(o.s();!(r=o.n()).done;){var f=r.value,d=f.pos.x-this.x,y=f.pos.y-this.y;if(Math.sqrt(d*d+y*y)<this.radius){if(1===f.type){for(var c=function(){return 2*Math.random()-1},g=0;g<1;g++)t.addEntity(new v({x:this.x,y:this.y},{x:300*c(),y:300*c()},"255,0,0",.2,.2));this.hit=!0,this.health-=.3}this.vx=.97*this.vx+60*f.vel.x*.03,this.vy=.97*this.vy+60*f.vel.y*.03,f.vel.x=.97*f.vel.x+this.vx/60*.03,f.vel.y=.97*f.vel.y+this.vy/60*.03}}}catch(p){o.e(p)}finally{o.f()}}},{key:"collideClosestGrid",value:function(t){for(var i=t.tileSize,e=Math.floor(this.x/i),s=Math.floor(this.y/i),h=Math.ceil(this.radius/i),a=-h;a<=h;a++)for(var n=-h;n<=h;n++){var r=a+e,l=n+s;if(t.boundsCheck(r,l)&&t.tiles[r+l*t.width]>1){var o=(l+.5)*i,u=(r+.5)*i-this.x,f=o-this.y,d=Math.sqrt(u*u+f*f);if(d<12){var y=u/d,c=f/d;this.x-=y*(12-d),this.y-=c*(12-d),this.vx-=.2*y,this.vy-=.2*c,this.vy*=.9,this.vx*=.9}}}}},{key:"render",value:function(t){t.fillStyle="#ff0000",t.translate(this.x,this.y),t.rotate(this.angle);t.beginPath(),t.arc(0,0,10,0,2*Math.PI,!1),t.fillStyle="#BCB9B8",t.fill(),t.lineWidth=2,t.strokeStyle="#003300",t.stroke(),t.beginPath(),t.arc(0,0,4,0,2*Math.PI,!1),t.fillStyle="#2C2C2C",t.fill(),t.lineWidth=1,t.strokeStyle="#22E403",t.stroke(),t.fillStyle="#00ff00",t.fillRect(9,-2,2,2),t.rotate(-this.angle),t.translate(-this.x,-this.y)}}]),t}(),w=function(){function t(i,e){h(this,t),this.debugMode=!1,this.height=e,this.width=i,this.tileSize=4,this.tiles=null,this.colors=[null,null,"#765432","#888888","#009900","#bb00bb","#ffff00","#000000"],this.colorsDark=[null,"#444444","#382716","#333333","#004900","#660066","#ffff00","#000000"],this.chunkWidth=Math.ceil(i/k),this.chunkHeight=Math.ceil(e/k),this.chunks=new Array(this.chunkWidth*this.chunkHeight),this.dirtyChunks=new Map,this.totalPurple=0}return n(t,[{key:"worldToGrid",value:function(t){return Math.floor(t/this.tileSize)}},{key:"getIndex",value:function(t,i){return t+this.width*i}},{key:"getVector2",value:function(t){return{x:t%this.width,y:Math.floor(t/this.width)}}},{key:"getChunk",value:function(t){var i=t.x/k,e=t.y/k;return this.chunks[i+e]}},{key:"boundsCheck",value:function(t,i){return t>=0&&i>=0&&t<this.width&&i<this.height}},{key:"buildChunks",value:function(){for(var t=0,i=0;i<this.chunkWidth;i++)for(var e=0;e<this.chunkHeight;e++){var s=new S(t,i*k,e*k);s.rebuild(this),this.chunks[i+e*this.chunkWidth]=s,t++}}},{key:"update",value:function(){l.isHit(l.F2)&&(this.debugMode=!this.debugMode,this.buildChunks())}},{key:"getBlockValue",value:function(t,i){return this.boundsCheck(t,i)?this.tiles[t+i*this.width]:0}},{key:"setBlockValue",value:function(t,i,e){if(!this.boundsCheck(t,i))return 0;var s=t+i*this.width,h=this.tiles[s];if(h!==e){5===h&&this.totalPurple--,5===e&&this.totalPurple++,this.tiles[t+i*this.width]=e;var a=Math.floor(t/k),n=Math.floor(i/k),r=this.chunks[a+n*this.chunkWidth];if(!r)return;r.dirty=!0,this.dirtyChunks.set(a+","+n,r)}}},{key:"rebuildDirty",value:function(){var t,i=this,e=[],s=u(this.dirtyChunks.values());try{for(s.s();!(t=s.n()).done;){var h=t.value;if(e.push(h),h.dirty){h.rebuild(this);break}}}catch(a){s.e(a)}finally{s.f()}e.forEach((function(t){return i.dirtyChunks.delete(Math.floor(t.x/k)+","+Math.floor(t.y/k))}))}},{key:"renderChunks",value:function(t){for(var i=0;i<this.chunkWidth;i++)for(var e=0;e<this.chunkHeight;e++){var s=this.chunks[i+e*this.chunkWidth];if(s.image){var h=i*k*this.tileSize,a=e*k*this.tileSize;t.drawImage(s.image,h,a)}}}}]),t}(),k=64,S=function(){function t(i,e,s){h(this,t),this.idx=i,this.x=e,this.y=s,this.image=null,this.dirty=!1,this.visited=!1}return n(t,[{key:"rebuild",value:function(t){var i=this,e=0;t.debugMode&&(e=1);var s=document.createElement("canvas");s.width=k*t.tileSize+1,s.height=k*t.tileSize+1;for(var h=s.getContext("2d"),a=0,n=0;n<k;n++)for(var r=0;r<k;r++){a=n===k-1||r===k-1?1:0;var l=n+this.x-1,o=r+this.y-1;if(!(l<0||o<0||l>t.width-1||o>t.height-1)){var u=t.tiles[l+o*t.width],f=t.colorsDark[u];f&&(f!==h.fillStyle&&(h.fillStyle=f),h.fillRect(n*t.tileSize,r*t.tileSize,t.tileSize-e+a,t.tileSize-e+a))}}for(var d=0;d<k;d++)for(var y=0;y<k;y++){a=d===k-1||y===k-1?1:0;var c=d+this.x,v=y+this.y;if(!(c<0||v<0||c>t.width-1||v>t.height-1)){var g=t.tiles[c+v*t.width],p=t.colors[g];p&&(p!==h.fillStyle&&(h.fillStyle=p),h.fillRect(d*t.tileSize,y*t.tileSize,t.tileSize-e+a,t.tileSize-e+a))}}if(t.debugMode){h.strokeStyle="rgba(255, 0, 0, 0.3)",h.lineWidth=5,h.strokeRect(0,0,s.width-e,s.height-e);var x="chunk #: "+this.idx;h.font="24px serif",h.fillStyle="rgba(0, 255, 0, 0.3)";var M=h.measureText(x),m=Math.floor(s.width/2-M.width/2),w=Math.floor(s.height-10);h.fillText(x,m,w)}var S=new Image;S.onload=function(){i.image=S},S.src=s.toDataURL("image/png")}}]),t}(),b=function(){function t(i,e){h(this,t),this.entities=[],this.fluid=i,this.cam=e}return n(t,[{key:"resetEntities",value:function(){this.entities.length=0}},{key:"addEntity",value:function(t){this.entities.push(t),t.init&&t.init(this)}},{key:"update",value:function(t,i){for(var e=0;e<this.entities.length;e++)this.entities[e].update(this,t,i);for(var s=0;s<this.entities.length;s++){var h=this.entities[s];h.deleteFlag&&(h.beforeDelete&&h.beforeDelete(this),this.entities.splice(s,1),s--)}}},{key:"render",value:function(t){this.entities.forEach((function(i){i.render(t)}))}}]),t}(),T=e(0),C=e.n(T);function z(t,i,e,s,h,a,n){for(var r=new C.a(i),l=new C.a(i+"a"),o=new C.a(i+"b"),u=new C.a(i+"c"),f=new Int8Array(t*t),d=2*h-1,y=0;y<t;y++)for(var c=0;c<t;c++){var v=y-t/2,g=c-t/2,p=Math.sqrt(v*v+g*g);if(p<a)f[y+c*t]=3;else{var x=p+r.noise2D(y/(10*s),c/(10*s))*s;if(x<e){if(f[y+c*t]=1,.66*l.noise2D(y/64,c/64)+.34*o.noise2D(y/32,c/32)<d&&(f[y+c*t]=x<e-5?2:4),2===n){var M=u.noise2D(y/64,c/64);M>.6?f[y+c*t]=6:M>.5&&(f[y+c*t]=2)}if(1===n){var m=u.noise2D(y/128,c/128);m>.8?f[y+c*t]=6:m>.7&&(f[y+c*t]=2)}}}}return f}var D=[{gen:function(){return z(600,"test"+Math.random(),150,4,.8,50,0)},outerRadius:180,waterSupply:2e3,goal:500,diggers:!1,eaters:!1,message:"LEVEL 1\n\nWelcome!\nHelp us take over these planets with a purple plant. It just needs water to grow!\nOnce it reaches critical mass, the mission is successful!"},{gen:function(){for(var t=z(600,"test"+Math.random(),180,4,.5,50,1),i=-60;i<=60;i++)for(var e=-30;e<=30;e++){var s=i*i/4+e*e;s<625?t[i+300+600*(e+170)]=6:s<841&&(t[i+300+600*(e+170)]=2)}return t},outerRadius:210,waterSupply:3e3,goal:2e3,diggers:!1,eaters:!1,message:"LEVEL 2\n\nWatch out for lava on this planet!\nPlants are flammable!"},{gen:function(){return z(600,"test"+Math.random(),200,4,.7,50,1)},outerRadius:230,waterSupply:3e3,goal:3e3,diggers:!1,eaters:!0,eaterCount:5,message:"LEVEL 3\n\nWhoa! This planet appears to have some inhabitants.\nI wonder if they are friendly?"},{gen:function(){return z(600,"test"+Math.random(),250,4,.5,50,2)},outerRadius:280,waterSupply:4e3,goal:8e3,diggers:!0,eaters:!0,eaterCount:5,message:"LEVEL 4\n\nRumor has it this planet also has worms\nthat may hatch if you disturb them!"},{gen:function(){return z(600,"test"+Math.random(),270,4,.5,50,2)},outerRadius:300,waterSupply:4e3,goal:25e3,diggers:!0,eaters:!0,eaterCount:5,message:"LEVEL 5\n\nWe are going to need a lot to reach critical mass here."},{gen:function(){return z(600,"test"+Math.random(),100,4,.8,50,0)},outerRadius:180,waterSupply:4e3,goal:25e3,diggers:!1,eaters:!1,message:"Thanks For Playing!"}],E={gen:function(){return z(600,"test"+Math.random(),200,4,.5,50,2)},outerRadius:230,waterSupply:3e3,goal:4e6,diggers:!1,eaters:!0,eaterCount:15,message:"",noFail:!0},F=function(){function t(i,e,s){h(this,t),this.height=e,this.width=i,this.zoom=1,this.position={x:s.x,y:s.y}}return n(t,[{key:"update",value:function(t){l.isDown(l.Z)&&(this.zoom+=.01),l.isDown(l.B)&&(this.zoom-=.01,this.zoom<=.1&&(this.zoom=.1)),this.position.x=t.x,this.position.y=t.y}},{key:"getCorner",value:function(){return{x:this.position.x,y:this.position.y}}}]),t}(),R=function(){function t(i,e,s){h(this,t),this.message=i,this.switchCallback=e,this.alpha=0,this.fadeIn=!0,this.wait=0,this.fadeOut=!1,this.done=!1,this.delay=s||300}return n(t,[{key:"render",value:function(t){this.fadeIn?(this.alpha+=.03,this.alpha>1&&(this.alpha=1,this.fadeIn=!1,this.wait=this.delay)):this.wait>0?(this.wait--,s.leftDown&&(this.wait=0),0===this.wait&&(this.switchCallback(),this.fadeOut=!0)):this.fadeOut&&(this.alpha-=.03,this.alpha<0&&(this.alpha=0,this.done=!0,this.fadeOut=!1)),t.font="30px cousine",t.fillStyle="rgba(0,0,0,"+this.alpha+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="rgba(255,255,255,"+this.alpha+")";for(var i=this.message.split("\n"),e=0;e<i.length;e++){var h=t.measureText(i[e]).width;t.fillText(i[e],(t.canvas.width-h)/2,t.canvas.height/2+30*e-i.length/2*30)}}}]),t}(),P=function(){function t(i,e){h(this,t),this.inMainMenu=!0,this.isPlaying=!1,this.currentlyDead=!1,this.deathCount=0,this.levelCount=0,this.grid=null,this.player=null,this.fluidManager=null,this.entityManager=null,this.cam=null,this.screenH=e,this.screenW=i,this.levelTransition=null}return n(t,[{key:"start",value:function(t){this.inMainMenu=t,this.grid=new w(600,600),this.cam=new F(this.screenW,this.screenH,{x:0,y:0}),this.player=new m(300*this.grid.tileSize,230*this.grid.tileSize),this.fluidManager=new d,this.entityManager=new b(this.fluidManager,this.cam),this.entityManager.addEntity(this.player),this.grid=new w(600,600);var i=D[this.levelCount];if(this.inMainMenu&&(i=E),this.entityManager.levelConfig=i,i.eaters)for(var e=0;e<i.eaterCount;e++){var s=Math.random()*Math.PI*2,h=i.outerRadius*this.grid.tileSize+100;this.entityManager.addEntity(new x(Math.sin(s)*h+this.grid.width*this.grid.tileSize/2,Math.cos(s)*h+this.grid.height*this.grid.tileSize/2))}this.grid.tiles=i.gen();for(var a=-40;a<40;a++)for(var n=-40;n<40;n++)a*a+n*n<400?this.grid.setBlockValue(300+a,233+n,1):a*a+n*n<529&&this.grid.setBlockValue(300+a,233+n,2),6===this.grid.getBlockValue(a+300,n+300-67)&&this.grid.setBlockValue(a+300,n+300-67,1);this.processGridForLava(),this.grid.setBlockValue(300,242,5);for(var r=0;r<100;r++){var l=15*Math.random();this.grid.setBlockValue(300+Math.floor(Math.random()*l-l/2),242+Math.floor(l),5)}this.grid.buildChunks()}},{key:"reset",value:function(){this.currentlyDead=!1,this.deathCount++,this.start(!1)}},{key:"update",value:function(t){this.grid.rebuildDirty(),this.fluidManager.update(this.grid,1,this.entityManager),this.grid.update(),this.player.health<0&&!this.entityManager.levelConfig.noFail&&(this.currentlyDead=!0,l.isHit(l.R)&&this.reset()),l.isHit(l.R)&&this.reset(),l.isHit(l.M)&&(this.levelCount=0,this.start(!0)),this.currentlyDead||this.entityManager.update(this.grid,t),this.checkWin()}},{key:"renderLevelTransition",value:function(t){this.levelTransition&&(this.levelTransition.render(t),this.levelTransition.done&&(this.levelTransition=null))}},{key:"checkWin",value:function(){var t=this;if(!this.entityManager.levelConfig.noFail&&(this.grid.totalPurple<=0&&(this.levelTransition||(this.levelTransition=new R("Mission Failed",(function(){t.start(!1)}),30))),this.grid.totalPurple>=this.entityManager.levelConfig.goal&&!this.levelTransition)){if(this.levelCount++,this.levelCount>=D.length)return this.levelCount=0,void this.start(!0);this.levelTransition=new R(D[this.levelCount].message,(function(){t.start(!1)}))}}},{key:"processGridForLava",value:function(){for(var t=0;t<this.grid.width;t++)for(var i=0;i<this.grid.height;i++)6===this.grid.tiles[t+i*this.grid.width]&&(this.grid.tiles[t+i*this.grid.width]=1,Math.random()>.9&&this.fluidManager.particles.push(new c(t*this.grid.tileSize,i*this.grid.tileSize,1)))}}]),t}(),A=function(){function t(i,e){h(this,t),this.x=i,this.y=e,this.buttonList=[]}return n(t,[{key:"setupMainMenu",value:function(t){t.font="40px cousine";var i={x:this.x/2-162.5,y:this.y/2-50-200},e={x:this.x/2-325/6,y:this.y/2+parseInt(t.font)/4-200},s=new L(325,100,i,e,"START");s.hit=function(){return"START_GAME_EVENT"},this.buttonList.push(s)}},{key:"update",value:function(t){if(s.leftHit())for(var i={x:s.x,y:s.y},e=0;e<this.buttonList.length;e++)if(console.log(i),console.log(this.buttonList[e].position),this.isInside(i,this.buttonList[e])&&"START_GAME_EVENT"===this.buttonList[e].hit())return!1;return!0}},{key:"render",value:function(t){for(var i=0;i<this.buttonList.length;i++)this.buttonList[i].render(t)}},{key:"isInside",value:function(t,i){return t.x>i.position.x&&t.x<i.position.x+i.w&&t.y<i.position.y+i.h&&t.y>i.position.y}}]),t}(),L=function(){function t(i,e,s,a,n){h(this,t),this.w=i,this.h=e,this.position=s,this.labelPosition=a,this.text=n,this.hit=function(){console.log("default button hit")}}return n(t,[{key:"render",value:function(t){t.font="40px cousine",t.beginPath(),t.rect(this.position.x,this.position.y,this.w,this.h),t.fillStyle="#FFFFFF",t.fillStyle="rgba(225,225,225,0.5)",t.fill(),t.lineWidth=2,t.strokeStyle="#000000",t.stroke(),t.closePath(),t.fillStyle="#000000",t.fillStyle="#FFFFFF",t.fillText(this.text,this.labelPosition.x,this.labelPosition.y)}}]),t}(),I=null,V=new P(1280,720),B=new r(1280,720),W=new A(1280,720),q=new Image(1280,720),H=0;function G(t){var i=(t-H)/1e3;if(H=t,I.setTransform(1,0,0,1,0,0),I.fillStyle="#000000",I.fillRect(0,0,I.canvas.width,I.canvas.height),V.entityManager){if(V.inMainMenu){var e=V.grid.width*V.grid.tileSize/2,s=(new Date).getTime()/16e3;V.cam.update({x:e+200*Math.sin(s)*4,y:e+200*Math.cos(s)*4})}else V.cam.update({x:V.player.x,y:V.player.y});I.transform(1,0,0,1,640,360),I.transform(Math.cos(V.cam.angle),-Math.sin(V.cam.angle),Math.sin(V.cam.angle),Math.cos(V.cam.angle),0,0),I.drawImage(q,-640,-640),I.resetTransform();var h=V.cam.position.x-V.grid.width*V.grid.tileSize/2,a=V.cam.position.y-V.grid.height*V.grid.tileSize/2;V.cam.angle=Math.atan2(a,h)+Math.PI/2,I.transform(1,0,0,1,640,360),I.transform(Math.cos(V.cam.angle),-Math.sin(V.cam.angle),Math.sin(V.cam.angle),Math.cos(V.cam.angle),0,0),I.transform(V.cam.zoom,0,0,V.cam.zoom,0,0),I.transform(1,0,0,1,-Math.floor(V.cam.getCorner().x),-Math.floor(V.cam.getCorner().y)),V.update(i);var n=V.grid.width*V.grid.tileSize/2,r=(V.entityManager.levelConfig.outerRadius-30)*V.grid.tileSize,l=I.createRadialGradient(n,n,r,n,n,r+180);l.addColorStop(0,"#87CEEB"),l.addColorStop(1,"rgba(0,0,0,0)"),I.fillStyle=l,I.fillRect(0,0,2*n,2*n),V.grid.renderChunks(I),V.entityManager.render(I),V.fluidManager.render(I),V.inMainMenu||B.render(I,V.player,V)}if(I.resetTransform(),V.inMainMenu){var o=!0;V.levelTransition||(o=W.update(I)),W.render(I),o||(V.levelTransition=new R(D[V.levelCount].message,(function(){V.inMainMenu=!1,V.start(!1)})))}V.renderLevelTransition(I),requestAnimationFrame(G)}!function(t){var i=document.createElement("canvas");i.width=1280,i.height=1280;var e=i.getContext("2d");e.fillStyle="#ffffff";for(var h=0;h<500;h++){var a=1280*Math.random(),n=1280*Math.random(),r=Math.floor(1*Math.random())+1;e.fillRect(a,n,r,r)}q.src=i.toDataURL("image/png"),I=t,s.init(I.canvas),W.setupMainMenu(I),V.start(!0),I&&requestAnimationFrame(G)}(function(t){var i=document.getElementById(t);return i.width=1280,i.height=720,i.getContext("2d")}("gamecanvas"))}],[[1,1]]]);
//# sourceMappingURL=main.1462e75a.chunk.js.map